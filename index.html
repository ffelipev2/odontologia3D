<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Universidad San SebastiÃ¡n - Visor 3D</title>
  <link rel="icon" href="data:," />
  <style>
    html, body { height: 100%; margin: 0; }
    body { background: #0b1020; color: #fff; font-family: system-ui, sans-serif; overflow: hidden; }
    header { text-align: center; padding: 10px 0; background: #111830; font-size: 20px; font-weight: 600; color: #ffffff; position: fixed; top: 0; left: 0; width: 100%; z-index: 5; }
    #progress { position: fixed; left: 50%; top: 70px; transform: translateX(-50%); background: rgba(0,0,0,.4); padding: 8px 12px; border-radius: 999px; font-size: 14px; backdrop-filter: blur(6px); }
    #credit { position: fixed; right: 14px; bottom: 12px; opacity: .7; font-size: 12px; }
    canvas { display: block; width: 100vw; height: 100vh; }
    #menuToggle { position: fixed; top: 80px; left: 12px; background: rgba(0,0,0,0.7); border: none; color: #fff; font-size: 22px; padding: 10px 14px; border-radius: 10px; cursor: pointer; z-index: 10; }
    #ui { position: fixed; left: 12px; top: 130px; z-index: 9; display: none; }
    .menu { background: rgba(0,0,0,.85); padding: 12px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,.35); backdrop-filter: blur(6px); width: 220px; }
    .menu h1 { margin: 0 0 8px; font-size: 16px; font-weight: 600; opacity: .9; }
    .menu button { display: block; width: 100%; margin: 6px 0; padding: 10px 12px; border: 0; border-radius: 12px; font-weight: 600; cursor: pointer; background: #ffffff; color:#111; }
    .menu button.secondary { background: #e5e7eb; }
    .menu hr{border:0;border-top:1px solid rgba(255,255,255,.15);margin:8px 0}
    @media (min-width: 768px) {
      #menuToggle { display: none; }
      #ui { display: block !important; }
    }
  </style>
</head>
<body>
  <header>Universidad San SebastiÃ¡n</header>
  <button id="menuToggle">â˜°</button>

  <div id="ui">
    <div class="menu">
      <h1>Modelos 3D</h1>
      <button id="btn-skull">CrÃ¡neo (OBJ)</button>
      <button id="btn-jaw">MandÃ­bula (OBJ)</button>
      <hr/>
      <button id="btn-reset" class="secondary">Recentrar vista</button>
    </div>
  </div>

  <div id="progress">Cargandoâ€¦ <span id="pct">0%</span></div>
  <div id="credit">Arrastra para rotar Â· Pincha para zoom Â· Dos dedos para mover</div>
  <canvas id="c"></canvas>

  <!-- ðŸ”¹ PANEL DE COORDENADAS PARA DEBUG / REFERENCIA DE VISTA -->
  <!-- 
    ðŸ’¡ Activa este bloque cuando necesites capturar o ajustar
    la posiciÃ³n / rotaciÃ³n del objeto y la cÃ¡mara para nuevos modelos.

    Muestra en vivo:
    - PosiciÃ³n y rotaciÃ³n del objeto actual
    - PosiciÃ³n y target de la cÃ¡mara
  -->
  <!--
  <div id="coordsPanel" style="
    position: fixed;
    bottom: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding: 10px;
    font-family: monospace;
    border-radius: 8px;
    font-size: 13px;
    z-index: 1000;
  ">
    <b>Objeto</b><br>
    posX: <span id="posX">0</span> | posY: <span id="posY">0</span> | posZ: <span id="posZ">0</span><br>
    rotX: <span id="rotX">0</span> | rotY: <span id="rotY">0</span> | rotZ: <span id="rotZ">0</span><br><br>
    <b>CÃ¡mara</b><br>
    camX: <span id="camX">0</span> | camY: <span id="camY">0</span> | camZ: <span id="camZ">0</span><br>
    targetX: <span id="tarX">0</span> | targetY: <span id="tarY">0</span> | targetZ: <span id="tarZ">0</span>
  </div>

  <script>
    // ðŸ”§ Actualiza cada 100 ms las coordenadas en pantalla
    // para conocer la posiciÃ³n de cÃ¡mara / objeto actual.
    function updateCoords() {
      const obj = window.currentObject;
      const cam = window.camera;
      const ctrl = window.controls;

      if (obj) {
        document.getElementById('posX').textContent = obj.position.x.toFixed(2);
        document.getElementById('posY').textContent = obj.position.y.toFixed(2);
        document.getElementById('posZ').textContent = obj.position.z.toFixed(2);
        document.getElementById('rotX').textContent = obj.rotation.x.toFixed(2);
        document.getElementById('rotY').textContent = obj.rotation.y.toFixed(2);
        document.getElementById('rotZ').textContent = obj.rotation.z.toFixed(2);
      }

      if (cam && ctrl) {
        document.getElementById('camX').textContent = cam.position.x.toFixed(2);
        document.getElementById('camY').textContent = cam.position.y.toFixed(2);
        document.getElementById('camZ').textContent = cam.position.z.toFixed(2);
        document.getElementById('tarX').textContent = ctrl.target.x.toFixed(2);
        document.getElementById('tarY').textContent = ctrl.target.y.toFixed(2);
        document.getElementById('tarZ').textContent = ctrl.target.z.toFixed(2);
      }
    }
    setInterval(updateCoords, 100);
  </script>
  -->

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
    import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';

    // Variables globales
    window.currentObject = null;
    window.camera = null;
    window.controls = null;

    const canvas = document.getElementById('c');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b1020);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.01, 1000);
    window.camera = camera;

    const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 1.0);
    dir.position.set(3, 5, 2);
    scene.add(dir);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.06;
    controls.enablePan = true;
    window.controls = controls;

    const pct = document.getElementById('pct');
    const progress = document.getElementById('progress');
    const manager = new THREE.LoadingManager();
    manager.onProgress = (_url, loaded, total) => pct.textContent = `${Math.round((loaded / total) * 100)}%`;
    manager.onLoad = () => progress.style.display = 'none';

    const objLoader = new OBJLoader(manager);
    const mtlLoader = new MTLLoader(manager);

    function clearCurrent() {
      if (window.currentObject) {
        currentObject.traverse?.(o => { if (o.isMesh) { o.geometry?.dispose?.(); o.material?.dispose?.(); } });
        scene.remove(currentObject);
        window.currentObject = null;
      }
    }

    // ðŸ”¹ Cargar MandÃ­bula
    function loadJaw() {
      clearCurrent();
      objLoader.load('./modelos/Yorik_Jaw.obj', obj => {
        obj.traverse(n => { if (n.isMesh) { n.castShadow = true; n.receiveShadow = true; } });

        // PosiciÃ³n inicial de la mandÃ­bula
        obj.position.set(-5.03, -5.24, -6.83);
        obj.rotation.set(0.00, 0.00, 0.00);

        window.currentObject = obj;
        scene.add(obj);

        // Vista inicial de la cÃ¡mara
        camera.position.set(154.66, -38.62, 123.34);
        controls.target.set(0.00, 0.00, 0.00);
        controls.update();
      });
    }

    // ðŸ”¹ Cargar CrÃ¡neo
    function loadSkull() {
      clearCurrent();
      mtlLoader.setPath('./modelos/');
      mtlLoader.load('Skull.mtl', materials => {
        materials.preload();
        objLoader.setMaterials(materials);
        objLoader.setPath('./modelos/');
        objLoader.load('Skull.obj', obj => {
          obj.traverse(n => { if (n.isMesh) { n.castShadow = true; n.receiveShadow = true; } });

          // PosiciÃ³n inicial del crÃ¡neo
          obj.position.set(0.00, 0.76, -13.81);
          obj.rotation.set(0.00, 0.00, 0.00);

          window.currentObject = obj;
          scene.add(obj);

          // Vista inicial de la cÃ¡mara
          camera.position.set(1.58, -44.73, 8.13);
          controls.target.set(1.65, -0.48, -2.64);
          controls.update();
        });
      });
    }

    document.getElementById('btn-skull').addEventListener('click', loadSkull);
    document.getElementById('btn-jaw').addEventListener('click', loadJaw);
    document.getElementById('btn-reset').addEventListener('click', () => controls.reset());

    // Cargar por defecto la mandÃ­bula
    loadJaw();

    window.addEventListener('resize', () => {
      const w = innerWidth, h = innerHeight;
      renderer.setSize(w, h);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    });

    (function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    })();
  </script>

  <!-- ðŸ”¹ MENU MÃ“VIL FUNCIONAL -->
  <script>
    // BotÃ³n hamburguesa para mostrar / ocultar el menÃº en pantallas pequeÃ±as
    const menuToggle = document.getElementById("menuToggle");
    const ui = document.getElementById("ui");

    menuToggle.addEventListener("click", () => {
      if (ui.style.display === "block") {
        ui.style.display = "none";
      } else {
        ui.style.display = "block";
      }
    });
  </script>
</body>
</html>
